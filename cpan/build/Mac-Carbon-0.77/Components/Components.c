/*
 * This file was generated automatically by xsubpp version 1.9508 from the
 * contents of Components.xs. Do not edit this file, edit Components.xs instead.
 *
 *	ANY CHANGES MADE HERE WILL BE LOST!
 *
 */

#line 1 "Components.xs"
/* $Header: /cvsroot/macperl/perl/macos/ext/Mac/Components/Components.xs,v 1.6 2006/06/22 02:58:18 pudge Exp $
 *
 *    Copyright (c) 1996 Matthias Neeracher
 *
 *    You may distribute under the terms of the Perl Artistic License,
 *    as specified in the README file.
 *
 * $Log: Components.xs,v $
 * Revision 1.6  2006/06/22 02:58:18  pudge
 * various minor fixes
 *
 * Revision 1.5  2006/06/20 01:39:18  pudge
 * Loads of fixes, mostly for Intel port
 *
 * Revision 1.4  2002/12/12 14:57:22  pudge
 * Update POD and docs
 *
 * Revision 1.3  2002/11/13 02:04:50  pudge
 * Aieeeeee!  Big ol' Carbon update.
 *
 * Revision 1.2  2000/09/09 22:18:26  neeri
 * Dynamic libraries compile under 5.6
 *
 * Revision 1.1  2000/08/14 03:30:19  neeri
 * Checked into Sourceforge
 *
 * Revision 1.2  1997/11/18 00:52:09  neeri
 * MacPerl 5.1.5
 *
 * Revision 1.1  1997/04/07 20:49:14  neeri
 * Synchronized with MacPerl 5.1.4a1
 *
 */

#define MAC_CONTEXT

#include "EXTERN.h"
#include "perl.h"
#include "XSUB.h"
#ifndef MACOS_TRADITIONAL
#include "../Carbon.h"
#endif
#include <Types.h>
#include <Memory.h>
#include <Components.h>

static ComponentDescription * MakeComponentDesc(
	SV *				componentType,
	SV *				componentSubType,
	SV *				componentManufacturer,
	unsigned long	componentFlags,
	unsigned long	componentFlagsMask)
{
	static ComponentDescription	desc;
	
	if (SvTRUE(componentType)) {
		desc.componentType = *(OSType *)SvPV_nolen(componentType);
		ConvertFourCharCode(typeType, (char *)&desc.componentType);
	} else
		desc.componentType = 0;
	if (SvTRUE(componentSubType)) {
		desc.componentSubType = *(OSType *)SvPV_nolen(componentSubType);
		ConvertFourCharCode(typeType, (char *)&desc.componentSubType);
	} else 
		desc.componentSubType = 0;
	if (SvTRUE(componentManufacturer)) {
		desc.componentManufacturer = *(OSType *)SvPV_nolen(componentManufacturer);
		ConvertFourCharCode(typeType, (char *)&desc.componentManufacturer);
	} else 
		desc.componentManufacturer = 0;
	desc.componentFlags		= componentFlags;
	desc.componentFlagsMask	= componentFlagsMask;
	
	return &desc;
}

static SV * MakeOSSV(OSType type)
{
	if (type) {
		OSType ntype = ntohl(type);
		return newSVpv((char *) &ntype, 4);
	} else {
		return newSVpv("", 0);
	}
}

#line 97 "Components.c"
XS(XS_Mac__Components_RegisterComponentResource); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_RegisterComponentResource)
{
    dXSARGS;
    if (items != 2)
	Perl_croak(aTHX_ "Usage: Mac::Components::RegisterComponentResource(tr, global)");
    {
	Handle	tr;
	short	global = (short)SvIV(ST(1));
	Component	RETVAL;
	dXSTARG;

	if (sv_derived_from(ST(0), "Handle")) {
	    IV tmp = SvIV((SV*)SvRV(ST(0)));
	    tr = INT2PTR(Handle,tmp);
	}
	else
	    Perl_croak(aTHX_ "tr is not of type Handle");
#line 108 "Components.xs"
	RETVAL = RegisterComponentResource((ComponentResourceHandle) tr, global);
#line 118 "Components.c"
	XSprePUSH; PUSHi(PTR2IV(RETVAL));
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_UnregisterComponent); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_UnregisterComponent)
{
    dXSARGS;
    if (items != 1)
	Perl_croak(aTHX_ "Usage: Mac::Components::UnregisterComponent(aComponent)");
    {
	Component	aComponent = INT2PTR(Component,SvIV(ST(0)));
	MacOSRet	RETVAL;
	dXSTARG;

	RETVAL = UnregisterComponent(aComponent);
	XSprePUSH; PUSHi((IV)!(gMacPerl_OSErr = (short)(RETVAL)));
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_FindNextComponent); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_FindNextComponent)
{
    dXSARGS;
    if (items < 1 || items > 6)
	Perl_croak(aTHX_ "Usage: Mac::Components::FindNextComponent(aComponent, componentType = &PL_sv_undef, componentSubType = &PL_sv_undef, componentManufacturer = &PL_sv_undef, componentFlags = 0, componentFlagsMask = 0)");
    {
	Component	aComponent = INT2PTR(Component,SvIV(ST(0)));
	SV *	componentType;
	SV *	componentSubType;
	SV *	componentManufacturer;
	unsigned long	componentFlags;
	unsigned long	componentFlagsMask;
	Component	RETVAL;
	dXSTARG;

	if (items < 2)
	    componentType = &PL_sv_undef;
	else {
	    componentType = ST(1);
	}

	if (items < 3)
	    componentSubType = &PL_sv_undef;
	else {
	    componentSubType = ST(2);
	}

	if (items < 4)
	    componentManufacturer = &PL_sv_undef;
	else {
	    componentManufacturer = ST(3);
	}

	if (items < 5)
	    componentFlags = 0;
	else {
	    componentFlags = (unsigned long)SvUV(ST(4));
	}

	if (items < 6)
	    componentFlagsMask = 0;
	else {
	    componentFlagsMask = (unsigned long)SvUV(ST(5));
	}
#line 142 "Components.xs"
	RETVAL = 
		FindNextComponent(
			aComponent, 
			MakeComponentDesc(componentType, componentSubType, componentManufacturer, componentFlags, componentFlagsMask));
#line 191 "Components.c"
	XSprePUSH; PUSHi(PTR2IV(RETVAL));
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_CountComponents); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_CountComponents)
{
    dXSARGS;
    if (items < 0 || items > 5)
	Perl_croak(aTHX_ "Usage: Mac::Components::CountComponents(componentType = &PL_sv_undef, componentSubType = &PL_sv_undef, componentManufacturer = &PL_sv_undef, componentFlags = 0, componentFlagsMask = 0)");
    {
	SV *	componentType;
	SV *	componentSubType;
	SV *	componentManufacturer;
	unsigned long	componentFlags;
	unsigned long	componentFlagsMask;
	long	RETVAL;
	dXSTARG;

	if (items < 1)
	    componentType = &PL_sv_undef;
	else {
	    componentType = ST(0);
	}

	if (items < 2)
	    componentSubType = &PL_sv_undef;
	else {
	    componentSubType = ST(1);
	}

	if (items < 3)
	    componentManufacturer = &PL_sv_undef;
	else {
	    componentManufacturer = ST(2);
	}

	if (items < 4)
	    componentFlags = 0;
	else {
	    componentFlags = (unsigned long)SvUV(ST(3));
	}

	if (items < 5)
	    componentFlagsMask = 0;
	else {
	    componentFlagsMask = (unsigned long)SvUV(ST(4));
	}
#line 163 "Components.xs"
	RETVAL = 
		CountComponents(
			MakeComponentDesc(componentType, componentSubType, componentManufacturer, componentFlags, componentFlagsMask));
#line 245 "Components.c"
	XSprePUSH; PUSHi((IV)RETVAL);
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_GetComponentInfo); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_GetComponentInfo)
{
    dXSARGS;
    if (items != 1)
	Perl_croak(aTHX_ "Usage: Mac::Components::GetComponentInfo(aComponent)");
    SP -= items;
    {
	Component	aComponent = INT2PTR(Component,SvIV(ST(0)));
#line 181 "Components.xs"
	ComponentDescription	desc;
	Handle					name;
	Handle					info;
#line 264 "Components.c"
#line 185 "Components.xs"
	name = NewEmptyHandle();
	info = NewEmptyHandle();
	gMacPerl_OSErr = GetComponentInfo(aComponent, &desc, name, info, nil);
	HLock(name);
	HLock(info);
	if (!gMacPerl_OSErr) 
		if (GIMME != G_ARRAY) {
			if (*name == NULL) {
	EXTEND(sp, 1);
	++sp;
	*sp = sv_newmortal();
	sv_setpvn(*sp, ((char *) ("")) + 1, ("")[0]);
			} else {
	EXTEND(sp, 1);
	++sp;
	*sp = sv_newmortal();
	sv_setpvn(*sp, ((char *) ((StringPtr)*name)) + 1, ((StringPtr)*name)[0]);
			}
		} else {
			XPUSHs(sv_2mortal(MakeOSSV(desc.componentType)));
			XPUSHs(sv_2mortal(MakeOSSV(desc.componentSubType)));
			XPUSHs(sv_2mortal(MakeOSSV(desc.componentManufacturer)));
			XPUSHs(sv_2mortal(newSViv(desc.componentFlags)));
			XPUSHs(sv_2mortal(newSViv(desc.componentFlagsMask)));
			if (*name == NULL) {
	EXTEND(sp, 1);
	++sp;
	*sp = sv_newmortal();
	sv_setpvn(*sp, ((char *) ("")) + 1, ("")[0]);
			} else {
	EXTEND(sp, 1);
	++sp;
	*sp = sv_newmortal();
	sv_setpvn(*sp, ((char *) ((StringPtr)*name)) + 1, ((StringPtr)*name)[0]);
			}
			if (*info == NULL) {
	EXTEND(sp, 1);
	++sp;
	*sp = sv_newmortal();
	sv_setpvn(*sp, ((char *) ("")) + 1, ("")[0]);
			} else {
	EXTEND(sp, 1);
	++sp;
	*sp = sv_newmortal();
	sv_setpvn(*sp, ((char *) ((StringPtr)*info)) + 1, ((StringPtr)*info)[0]);
			}
		}
	DisposeHandle(name);
	DisposeHandle(info);
#line 315 "Components.c"
	PUTBACK;
	return;
    }
}

XS(XS_Mac__Components_GetComponentListModSeed); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_GetComponentListModSeed)
{
    dXSARGS;
    if (items != 0)
	Perl_croak(aTHX_ "Usage: Mac::Components::GetComponentListModSeed()");
    {
	long	RETVAL;
	dXSTARG;

	RETVAL = GetComponentListModSeed();
	XSprePUSH; PUSHi((IV)RETVAL);
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_OpenComponent); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_OpenComponent)
{
    dXSARGS;
    if (items != 1)
	Perl_croak(aTHX_ "Usage: Mac::Components::OpenComponent(aComponent)");
    {
	Component	aComponent = INT2PTR(Component,SvIV(ST(0)));
	ComponentInstance	RETVAL;
	dXSTARG;

	RETVAL = OpenComponent(aComponent);
	XSprePUSH; PUSHi(PTR2IV(RETVAL));
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_CloseComponent); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_CloseComponent)
{
    dXSARGS;
    if (items != 1)
	Perl_croak(aTHX_ "Usage: Mac::Components::CloseComponent(aComponentInstance)");
    {
	ComponentInstance	aComponentInstance = INT2PTR(ComponentInstance,SvIV(ST(0)));
	MacOSRet	RETVAL;
	dXSTARG;

	RETVAL = CloseComponent(aComponentInstance);
	XSprePUSH; PUSHi((IV)!(gMacPerl_OSErr = (short)(RETVAL)));
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_GetComponentInstanceError); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_GetComponentInstanceError)
{
    dXSARGS;
    if (items != 1)
	Perl_croak(aTHX_ "Usage: Mac::Components::GetComponentInstanceError(aComponentInstance)");
    {
	ComponentInstance	aComponentInstance = INT2PTR(ComponentInstance,SvIV(ST(0)));
	MacOSRet	RETVAL;
	dXSTARG;

	RETVAL = GetComponentInstanceError(aComponentInstance);
	XSprePUSH; PUSHi((IV)!(gMacPerl_OSErr = (short)(RETVAL)));
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_ComponentFunctionImplemented); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_ComponentFunctionImplemented)
{
    dXSARGS;
    if (items != 2)
	Perl_croak(aTHX_ "Usage: Mac::Components::ComponentFunctionImplemented(ci, ftnNumber)");
    {
	ComponentInstance	ci = INT2PTR(ComponentInstance,SvIV(ST(0)));
	short	ftnNumber = (short)SvIV(ST(1));
	long	RETVAL;
	dXSTARG;

	RETVAL = ComponentFunctionImplemented(ci, ftnNumber);
	XSprePUSH; PUSHi((IV)RETVAL);
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_GetComponentVersion); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_GetComponentVersion)
{
    dXSARGS;
    if (items != 1)
	Perl_croak(aTHX_ "Usage: Mac::Components::GetComponentVersion(ci)");
    {
	ComponentInstance	ci = INT2PTR(ComponentInstance,SvIV(ST(0)));
	long	RETVAL;
	dXSTARG;

	RETVAL = GetComponentVersion(ci);
	XSprePUSH; PUSHi((IV)RETVAL);
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_SetDefaultComponent); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_SetDefaultComponent)
{
    dXSARGS;
    if (items != 2)
	Perl_croak(aTHX_ "Usage: Mac::Components::SetDefaultComponent(aComponent, flags)");
    {
	Component	aComponent = INT2PTR(Component,SvIV(ST(0)));
	short	flags = (short)SvIV(ST(1));
	MacOSRet	RETVAL;
	dXSTARG;

	RETVAL = SetDefaultComponent(aComponent, flags);
	XSprePUSH; PUSHi((IV)!(gMacPerl_OSErr = (short)(RETVAL)));
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_OpenDefaultComponent); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_OpenDefaultComponent)
{
    dXSARGS;
    if (items < 1 || items > 2)
	Perl_croak(aTHX_ "Usage: Mac::Components::OpenDefaultComponent(componentType, componentSubType = 0)");
    {
	OSType	componentType;
	OSType	componentSubType;
	ComponentInstance	RETVAL;
	dXSTARG;

	memcpy(&componentType, SvPV_nolen(ST(0)), sizeof(OSType));
	componentType = ntohl(componentType);

	if (items < 2)
	    componentSubType = 0;
	else {
	    memcpy(&componentSubType, SvPV_nolen(ST(1)), sizeof(OSType));
	    componentSubType = ntohl(componentSubType);
	}

	RETVAL = OpenDefaultComponent(componentType, componentSubType);
	XSprePUSH; PUSHi(PTR2IV(RETVAL));
    }
    XSRETURN(1);
}

XS(XS_Mac__Components_RegisterComponentResourceFile); /* prototype to pass -Wmissing-prototypes */
XS(XS_Mac__Components_RegisterComponentResourceFile)
{
    dXSARGS;
    if (items != 2)
	Perl_croak(aTHX_ "Usage: Mac::Components::RegisterComponentResourceFile(resRefNum, global)");
    {
	short	resRefNum = (short)SvIV(ST(0));
	short	global = (short)SvIV(ST(1));
	long	RETVAL;
	dXSTARG;

	RETVAL = RegisterComponentResourceFile(resRefNum, global);
	XSprePUSH; PUSHi((IV)RETVAL);
#line 332 "Components.xs"
	if (RETVAL < 0) {
		gMacPerl_OSErr = (short) RETVAL;
		XSRETURN_UNDEF;
	}
#line 488 "Components.c"
    }
    XSRETURN(1);
}

#ifdef __cplusplus
extern "C"
#endif
XS(boot_Mac__Components); /* prototype to pass -Wmissing-prototypes */
XS(boot_Mac__Components)
{
    dXSARGS;
    char* file = __FILE__;

    XS_VERSION_BOOTCHECK ;

        newXS("Mac::Components::RegisterComponentResource", XS_Mac__Components_RegisterComponentResource, file);
        newXS("Mac::Components::UnregisterComponent", XS_Mac__Components_UnregisterComponent, file);
        newXS("Mac::Components::FindNextComponent", XS_Mac__Components_FindNextComponent, file);
        newXS("Mac::Components::CountComponents", XS_Mac__Components_CountComponents, file);
        newXS("Mac::Components::GetComponentInfo", XS_Mac__Components_GetComponentInfo, file);
        newXS("Mac::Components::GetComponentListModSeed", XS_Mac__Components_GetComponentListModSeed, file);
        newXS("Mac::Components::OpenComponent", XS_Mac__Components_OpenComponent, file);
        newXS("Mac::Components::CloseComponent", XS_Mac__Components_CloseComponent, file);
        newXS("Mac::Components::GetComponentInstanceError", XS_Mac__Components_GetComponentInstanceError, file);
        newXS("Mac::Components::ComponentFunctionImplemented", XS_Mac__Components_ComponentFunctionImplemented, file);
        newXS("Mac::Components::GetComponentVersion", XS_Mac__Components_GetComponentVersion, file);
        newXS("Mac::Components::SetDefaultComponent", XS_Mac__Components_SetDefaultComponent, file);
        newXS("Mac::Components::OpenDefaultComponent", XS_Mac__Components_OpenDefaultComponent, file);
        newXS("Mac::Components::RegisterComponentResourceFile", XS_Mac__Components_RegisterComponentResourceFile, file);
    XSRETURN_YES;
}

